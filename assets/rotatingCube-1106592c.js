(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=a(t);fetch(t.href,i)}})();var B=1e-6,z=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function T(){var e=new z(16);return z!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function O(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function U(e,r,a){var n=r[0],t=r[1],i=r[2],c=r[3],s=r[4],f=r[5],l=r[6],o=r[7],p=r[8],d=r[9],h=r[10],x=r[11],w=r[12],M=r[13],P=r[14],u=r[15],v=a[0],g=a[1],m=a[2],y=a[3];return e[0]=v*n+g*s+m*p+y*w,e[1]=v*t+g*f+m*d+y*M,e[2]=v*i+g*l+m*h+y*P,e[3]=v*c+g*o+m*x+y*u,v=a[4],g=a[5],m=a[6],y=a[7],e[4]=v*n+g*s+m*p+y*w,e[5]=v*t+g*f+m*d+y*M,e[6]=v*i+g*l+m*h+y*P,e[7]=v*c+g*o+m*x+y*u,v=a[8],g=a[9],m=a[10],y=a[11],e[8]=v*n+g*s+m*p+y*w,e[9]=v*t+g*f+m*d+y*M,e[10]=v*i+g*l+m*h+y*P,e[11]=v*c+g*o+m*x+y*u,v=a[12],g=a[13],m=a[14],y=a[15],e[12]=v*n+g*s+m*p+y*w,e[13]=v*t+g*f+m*d+y*M,e[14]=v*i+g*l+m*h+y*P,e[15]=v*c+g*o+m*x+y*u,e}function V(e,r,a){var n=a[0],t=a[1],i=a[2],c,s,f,l,o,p,d,h,x,w,M,P;return r===e?(e[12]=r[0]*n+r[4]*t+r[8]*i+r[12],e[13]=r[1]*n+r[5]*t+r[9]*i+r[13],e[14]=r[2]*n+r[6]*t+r[10]*i+r[14],e[15]=r[3]*n+r[7]*t+r[11]*i+r[15]):(c=r[0],s=r[1],f=r[2],l=r[3],o=r[4],p=r[5],d=r[6],h=r[7],x=r[8],w=r[9],M=r[10],P=r[11],e[0]=c,e[1]=s,e[2]=f,e[3]=l,e[4]=o,e[5]=p,e[6]=d,e[7]=h,e[8]=x,e[9]=w,e[10]=M,e[11]=P,e[12]=c*n+o*t+x*i+r[12],e[13]=s*n+p*t+w*i+r[13],e[14]=f*n+d*t+M*i+r[14],e[15]=l*n+h*t+P*i+r[15]),e}function G(e,r,a){var n=a[0],t=a[1],i=a[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*i,e[9]=r[9]*i,e[10]=r[10]*i,e[11]=r[11]*i,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function b(e,r,a){var n=Math.sin(a),t=Math.cos(a),i=r[4],c=r[5],s=r[6],f=r[7],l=r[8],o=r[9],p=r[10],d=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*t+l*n,e[5]=c*t+o*n,e[6]=s*t+p*n,e[7]=f*t+d*n,e[8]=l*t-i*n,e[9]=o*t-c*n,e[10]=p*t-s*n,e[11]=d*t-f*n,e}function R(e,r,a){var n=Math.sin(a),t=Math.cos(a),i=r[0],c=r[1],s=r[2],f=r[3],l=r[8],o=r[9],p=r[10],d=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*t-l*n,e[1]=c*t-o*n,e[2]=s*t-p*n,e[3]=f*t-d*n,e[8]=i*n+l*t,e[9]=c*n+o*t,e[10]=s*n+p*t,e[11]=f*n+d*t,e}function F(e,r,a){var n=Math.sin(a),t=Math.cos(a),i=r[0],c=r[1],s=r[2],f=r[3],l=r[4],o=r[5],p=r[6],d=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*t+l*n,e[1]=c*t+o*n,e[2]=s*t+p*n,e[3]=f*t+d*n,e[4]=l*t-i*n,e[5]=o*t-c*n,e[6]=p*t-s*n,e[7]=d*t-f*n,e}function N(e,r,a,n,t){var i=1/Math.tan(r/2),c;return e[0]=i/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==1/0?(c=1/(n-t),e[10]=(t+n)*c,e[14]=2*t*n*c):(e[10]=-1,e[14]=-2*n),e}var L=N;function S(e,r,a,n){var t,i,c,s,f,l,o,p,d,h,x=r[0],w=r[1],M=r[2],P=n[0],u=n[1],v=n[2],g=a[0],m=a[1],y=a[2];return Math.abs(x-g)<B&&Math.abs(w-m)<B&&Math.abs(M-y)<B?O(e):(o=x-g,p=w-m,d=M-y,h=1/Math.hypot(o,p,d),o*=h,p*=h,d*=h,t=u*d-v*p,i=v*o-P*d,c=P*p-u*o,h=Math.hypot(t,i,c),h?(h=1/h,t*=h,i*=h,c*=h):(t=0,i=0,c=0),s=p*c-d*i,f=d*t-o*c,l=o*i-p*t,h=Math.hypot(s,f,l),h?(h=1/h,s*=h,f*=h,l*=h):(s=0,f=0,l=0),e[0]=t,e[1]=s,e[2]=o,e[3]=0,e[4]=i,e[5]=f,e[6]=p,e[7]=0,e[8]=c,e[9]=l,e[10]=d,e[11]=0,e[12]=-(t*x+i*w+c*M),e[13]=-(s*x+f*w+l*M),e[14]=-(o*x+p*w+d*M),e[15]=1,e)}function C(){var e=new z(3);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function A(e,r,a){var n=new z(3);return n[0]=e,n[1]=r,n[2]=a,n}(function(){var e=C();return function(r,a,n,t,i,c){var s,f;for(a||(a=3),n||(n=0),t?f=Math.min(t*a+n,r.length):f=r.length,s=n;s<f;s+=a)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],i(e,e,c),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}})();function q(e,r,a,n){const t=I(r,a,n),i=Y(e),c=T();return U(c,i,t),c}function I(e={x:0,y:0,z:0},r={x:0,y:0,z:0},a={x:1,y:1,z:1}){const n=T();return V(n,n,A(e.x,e.y,e.z)),b(n,n,r.x),R(n,n,r.y),F(n,n,r.z),G(n,n,A(a.x,a.y,a.z)),n}const D=A(0,0,0),W=A(0,1,0);function Y(e,r=60/180*Math.PI,a=.1,n=100,t={x:0,y:0,z:0}){const i=T(),c=A(t.x,t.y,t.z);V(i,i,c),S(i,c,D,W);const s=T();return L(s,r,e,a,n),U(s,s,i),s}async function _(e){if(!navigator.gpu)throw new Error("Not Support WebGPU");const r=await navigator.gpu.requestAdapter();if(!r)throw new Error("No Adapter Found");const a=await r.requestDevice(),n=e.getContext("webgpu"),t=navigator.gpu.getPreferredCanvasFormat();n.configure({device:a,format:t,alphaMode:"opaque"});const i=window.devicePixelRatio||1;e.width=e.clientWidth*i,e.height=e.clientHeight*i;const c={width:e.width,height:e.height};return{device:a,context:n,format:t,size:c}}async function H(e,r,a,n){const t=await e.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:e.createShaderModule({code:`
                    @binding(0) @group(0) var<uniform> mvpMatrix : mat4x4<f32>;
                    struct VertexOutput {
                        @builtin(position) Position : vec4<f32>,
                        @location(0) fragPosition: vec4<f32>
                    };

                    @vertex
                    fn main(
                        @location(0) position : vec4<f32>,
                    ) -> VertexOutput {
                        var output : VertexOutput;
                        output.Position = mvpMatrix * position;
                        // output.fragPosition = 0.5 * (position + vec4<f32>(0.1, 0.1, 0.1, 1.0));
                        output.fragPosition = position;
                        return output;}`}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:e.createShaderModule({code:`
                @fragment
                fn main(
                    @location(0) fragPosition: vec4<f32>
                ) -> @location(0) vec4<f32> {
                    // return fragPosition;
                    return vec4(1,0,0,1);
                }
                `}),entryPoint:"main",targets:[{format:r}]},primitive:{topology:"point-list",cullMode:"back",frontFace:"ccw"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),i=e.createTexture({size:a,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),c=i.createView(),s=e.createBuffer({label:"GPUBuffer store vertex",size:3*n.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(s,0,n);const f=e.createBuffer({label:"GPUBuffer store 4x4 matrix",size:4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),l=e.createBindGroup({label:"Uniform Group with Matrix",layout:t.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:f}}]});return{pipeline:t,vertexBuffer:s,mvpBuffer:f,uniformGroup:l,depthTexture:i,depthView:c}}function X(e,r,a,n){const t=e.createCommandEncoder(),i={colorAttachments:[{view:r.getCurrentTexture().createView(),clearValue:{r:1,g:1,b:1,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:a.depthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},c=t.beginRenderPass(i);c.setPipeline(a.pipeline),c.setVertexBuffer(0,a.vertexBuffer),c.setBindGroup(0,a.uniformGroup),c.draw(n),c.end(),e.queue.submit([t.finish()])}function j(e){const r=new FileReader;let a=new Float32Array;r.onload=n=>{const i=n.target.result.split(/\r?\n/);let c=[];for(const s of i)s.split(/[ ,]/).map(Number).forEach(l=>{c.push(l)});a=Float32Array.from(c,s=>s.valueOf()),console.log(a),E=a,K()},r.readAsText(e)}async function K(){const e=document.querySelector("canvas");if(!e)throw new Error("No Canvas");const{device:r,context:a,format:n,size:t}=await _(e),i=await H(r,n,t,E);let c=t.width/t.height;const s={x:0,y:-.1,z:-.3},f={x:1,y:1,z:1},l={x:0,y:.5,z:0};function o(){l.y-=.01;const p=q(c,s,l,f);r.queue.writeBuffer(i.mvpBuffer,0,p.buffer),E&&X(r,a,i,E.byteLength/4),requestAnimationFrame(o)}o(),window.addEventListener("resize",()=>{t.width=e.width=e.clientWidth*devicePixelRatio,t.height=e.height=e.clientHeight*devicePixelRatio,i.depthTexture.destroy(),i.depthTexture=r.createTexture({size:t,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),i.depthView=i.depthTexture.createView(),c=t.width/t.height})}let E;document.getElementById("fileInput").addEventListener("change",e=>{const a=e.target.files[0];j(a)});
